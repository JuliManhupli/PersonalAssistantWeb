{% extends 'personal_assistant/base.html' %}

{% block title %}
Address Book
{% endblock %}

{% load static %}
<link rel="stylesheet" href="{% static 'addressbook/style.css' %}">

{% block content %}

{% if search_form.errors and search_form.non_field_errors %}
<div class="alert alert-danger" role="alert">
    {{search_form.non_field_errors}}
</div>
{% endif %}

{% if user.is_authenticated %}

<div class="quote ms-5 col-md-7" itemscope="" itemtype="http://schema.org/CreativeWork">
    <p>
        <p class="search_area">
            <span>
                <a href="{% url 'address_book:contact_add' %}" class="btn btn-primary ms-3">Додати Контакт</a>
            </span>
            <form id="search-form" action="{% url 'address_book:contact_search' %}" method="GET">
                <div class="row g-3 align-items-center ms-3">
                    <div class="col-auto">
                        <label for="search" class="col-form-label"><b>Пошук Контактiв</b></label>
                    </div>
                    <div class="col-md-10 search_form">
                        {% comment %}
                        <input type="text" id="search_form" name="search_form" {{ search_form.query.value}}>
                        {% endcomment %}
                        {{ search_form.query }}
                    </div>
                    <div class="col-auto">
                        <button type="submit" class="btn btn-info">Пошук</button>
                    </div>
                    <div class="col-auto">
                        <span>{{ search_form.errors.query }}</span>
                    </div>
                    {% if messages %}
                    <div class="messages">
                        {% for message in messages %}
                        <span {% if message.tags %} class="alert alert-info" {% endif %}>{{ message }}</span>
                        {% endfor %}
                    </div>
                    <p></p>
                    {% endif %}
                </div>
            </form>
            <div>
                <form id="birthday-form" action="{% url 'address_book:upcoming_birthdays' %}" method="post">
                    {% csrf_token %}
                    <div class="row g-3 align-items-center ms-3">
                        <div class="col-auto">
                            <label for="search" class="col-form-label"><b>Днi народження</b></label>
                        </div>
                        <div class="col-md-10 search_form">
                            {{ birthday_form.shift_day }}
                        </div>
                        <div class="col-auto">
                            <button type="submit" class="btn btn-info">Пошук</button>
                        </div>
                    </div>
                </form>
            </div>
        </p>
    </p>
</div>

<div class="container mt-3">
    <h2>Адресна книга</h2>
</div>

<div class="row">
    <div class="col-md-8">

    {% for contact in contacts %}

    <div class="quote ms-5" itemscope="" itemtype="http://schema.org/CreativeWork">
        <h3>{{ contact.first_name }} {{ contact.last_name }}</h3>
        <span class="text" itemprop="text">
            <p>Адреса: {{ contact.address }}</p>
            <p>Телефон: {{ contact.phone }}</p>
            <p>Електронна адреса: {{ contact.email }}</p>
            <p>День народження: {{ contact.birthday }}</p>
            <div>
                {% if user.is_authenticated and contact.user == user %}
                    <span class="mb-3" style="float: right;">
                        <a href="{% url 'address_book:contact_edit' contact.id %}" class="btn btn-secondary">Оновити</a>
                        <a href="{% url 'address_book:contact_delete' contact.id %}" class="btn btn-danger">Видалити</a>
                    </span>
                {% endif %}
            </div>
            
        </span>

    </div>

    {% endfor %}

    <nav>
        <ul class="pager">
            <li class="previous ms-5" style="float: left;">
                <a class="{% if not contact_paginate.has_previous %} disabled {% endif %}"
                   href="{% if contact_paginate.has_previous %} {% url 'address_book:contact_paginate' contact_paginate.previous_page_number %} {% else %} # {% endif %}">
                       <span class="btn btn-secondary" aria-hidden="true">←</span> Попередня </a>
            </li>

            <li class="next" class="btn btn-secondary">
                <a class="{% if not contact_paginate.has_next %} disabled {% endif %}"
                   href="{% if contact_paginate.has_next %} {% url 'address_book:contact_paginate' contact_paginate.next_page_number %} {% else %} # {% endif %}">
                       Наступна <span class="btn btn-secondary" aria-hidden="true">→</span></a>
            </li>
        </ul>
    </nav>

    </div>
</div>

{% endif %}

{% endblock %}

<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
<script>
    function updateSliderValue(value) {
        // Обновление значения span при изменении ползунка
        document.getElementById("rangeValue").textContent = value;
    }

    // Установка начального значения
    window.onload = function() {
        var initialValue = document.getElementById("customRange2").value;
        document.getElementById("rangeValue").textContent = initialValue;
    };
</script>